<!DOCTYPE HTML>

<html>
	<head>
		<title>Telebot</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
        <link rel="stylesheet" href="/assets/css/main.css" />
		<noscript><link rel="stylesheet" href="/assets/css/noscript.css" /></noscript>
	</head>
	<body class="is-preload">

		<!-- Page Wrapper -->
			<div id="page-wrapper">

				<!-- Header -->
					<header id="header">
						<h1><a href="/index.html">Main page</a></h1>
						<nav id="nav">
							<ul>
								<li class="special">
									<a href="#menu" class="menuToggle"><span>Menu</span></a>
									<div id="menu">
										<ul>
											<li><a href="/Python/example.html">Python</a></li>
											<li><a href="/C++/examples.html">C++</a></li>
											<li><a href="/About_me.html">About me</a></li>
										</ul>
									</div>
								</li>
							</ul>
						</nav>
					</header>

				<!-- Main -->
					<article id="main">

						<header>
						       
							
							<h2>Telebot</h2>
							<p>A program for sending a file to the sandbox ATHENA and giving a response.</p>
						</header>
						
						<section class="wrapper style5">
							<div class="inner">
								<section>
									<hr />
									<header>
										
                                                        <h3>Telebot </h2>
							
<h5><p><b>
Send the file to the telegram bot. Get a PDF report with the results of the antivirus scan.
</b></p></h5>
<p align="justify">
<span class="image left"><img src="/images/main.jpg" height: auto alt="" /></span><br>
</p>
<br>
<p align="justify">										
Telebot is created to upload files for checking. Then the files are sent via API to the ATHENA Sandbox and a response is returned. The response contains the antivirus verdict.
</p>
<br>
<img src="/images/Telebot_report.png" height: auto alt="" />
<br>

									
<hr>																
<details>
<summary>Code</summary>
<pre><code>	
import tkinter as tk
import requests
import os
import re
import mimetypes

downloadurl = 'https://bdu.fstec.ru/files/documents/thrlist.xlsx'

#Функция проверки URL загрузки угроз ФСТЭК
def isValidURL(str):
    regex = ("((http|https)://)(www.)?" +
             "[a-zA-Z0-9@:%._\\+~#?&//=]" +
             "{2,256}\\.[a-z]" +
             "{2,6}\\b([-a-zA-Z0-9@:%" +
             "._\\+~#?&//=]*)")

    p = re.compile(regex)

    if (str == None):
        return False

    if (re.search(p, str)):
        return True
    else:
        return False

#Функция проверки URL, что загружаемый файл является типом Excel
def isExcelMime(str):
    #Встроенный тип файла xlsx
    xlsx=('application/vnd.openxmlformats-officedocument.spreadsheetml.sheet', None)

    if ((mimetypes.guess_type(str)) == xlsx):
        return True
    else:
        return False

def show_message():

    #label["text"] = entry.get()  # получаем введенный текст
    lab_after_change["text"] = " URL изменен"  # получаем введенный текст
    global downloadurl
    print(utl_entry.get())
    downloadurl = utl_entry.get()
    print(type(downloadurl))
    filename = downloadurl[downloadurl.rfind('/') + 1:]  # rfind - найти индекс самого последнего символа '/'
    print(filename)

# загрузка thrlist по блокам и запись в файл
def loadfromweb(req_get, downloadurl):
    filename = req_get.url[downloadurl.rfind('/') + 1:]  # rfind - найти индекс самого последнего символа '/'
    print(filename)
    with open(filename, 'wb') as f:
        for chunk in req_get.iter_content(chunk_size=8192):
            if chunk:
                f.write(chunk)
    print(os.getcwd())

# изменить цвет кнопки при наведении на нее мышкой
def changeOnHover(button, colorOnHover, colorOnLeave):
    button.bind("<Enter>", func=lambda e: button.config(  # 2
        background=colorOnHover))
    button.bind("<Leave>", func=lambda e: button.config(  # 3 #4
        background=colorOnLeave))

def click_button():
    global downloadurl

    if ((isValidURL(downloadurl) == True) and (isExcelMime(downloadurl) == True)):
        #print("Yes")
        try:
            req = requests.get(downloadurl, headers={'User-agent': 'your bot 0.1'},
                               verify=False)  # без проверки сертификата
            # если ответ успешен, исключения задействованы не будут
            req.raise_for_status()
        except Exception as err:
            proxies = {'https': 'http://10.105.0.217:3128'}
            req = requests.session()
            req.proxies.update(proxies)
            req_get = req.get(downloadurl, headers={'User-agent': 'your bot 0.1'},
                              verify=False)
            loadfromweb(req_get, downloadurl)  # В функцию  loadfromweb передается req_get -сессия
            lab_file2["text"]="Файл загружен в директорию " + os.getcwd()
        # else выполняется в случае успеха в блоке try
        else:
            loadfromweb(req, downloadurl)  # В функцию  loadfromweb передается req - запрос
            lab_file2["text"] = "Файл загружен в директорию " + os.getcwd()

    else:
        #print("No")
        lab_file2["text"] = " URL для загрузки файла Excel некорректен"


root = tk.Tk()
root.title('Загрузка угроз ФСТЭК')

root.geometry("1100x320")  # Размер окна интерфейса

# Виджет для загрузки файла с угрозами
canv_load = tk.Canvas(root, width=200, height=400, borderwidth=3, relief='ridge', bg='#DCDCDC')
canv_load.pack(padx=20, pady=20,
               anchor=tk.NW)  # отступ виджета от границ контейнера по горизонтали/вертикали NW-верхний левый угол

lab_load = tk.Label(canv_load, text="Загрузить файл с угрозами", width=100, height=1, anchor="nw",
                    # NW-верхний левый угол
                    font=("Сourier new", 12, 'bold'), bg='#DCDCDC')
lab_load.pack(padx=10,pady=(10, 5))  # pady - верхний/нижний отступ виджета от границ контейнера по вертикали

lab_url = tk.Label(canv_load, text="Файл будет загружен с указанного URL.",width=100, height=1,anchor="nw",font=("Сourier new", 10),bg='#DCDCDC')
lab_url.pack(padx=10, pady=0,anchor="nw")
lab_url2 = tk.Label(canv_load, text="При необходимости введите новый URL.",width=100, height=1,anchor="nw",font=("Сourier new", 10), bg='#DCDCDC')
lab_url2.pack(padx=8, pady=5,anchor="nw")

#Label для отображения URL после изменения пользователем
lab_after_change = tk.Label(canv_load, width=100, height=1,anchor="nw",font=("Сourier new", 10), bg='#DCDCDC')
lab_after_change.pack(padx=5, pady=0,anchor="nw")

#Поле для ввода URL
utl_entry = tk.Entry(canv_load,width=100, font=("Times new roman", 12))
utl_entry.insert(0, downloadurl)
utl_entry.pack(padx=10, pady=0,anchor="nw")

#Кнопка для изменения URL пользователем
change_url_btn = tk.Button(canv_load, text="Изменить URL",font=("Сourier new", 12), bg="#828282", fg="white",height=1, width=15, command=show_message)
change_url_btn.pack(padx=10, pady=0,anchor="nw")

#Label для отображения состояния загрузки файл угроз (Загружен или есть ошибка URL)
lab_file2 = tk.Label(canv_load, text="Сейчас файл не загружен",width=100, height=1,anchor="nw",font=("Сourier new", 10),
                    bg='#DCDCDC')
lab_file2.pack(padx=10, pady=(5, 0),anchor="nw")

#Кнопка для загрузки Угроз
browse_btn = tk.Button(canv_load, text="Загрузить", font=("Сourier new", 12), bg="#828282", fg="white",
                       height=1, width=15, command=click_button)
browse_btn.pack(padx=10, pady=12, anchor="nw")

#Функция для изменения цвета кнопки при наведении на нее мышкой
changeOnHover(browse_btn, "#C7D0CC", "#828282")  # изменить цвет кнопки при наведении на нее мышкой
changeOnHover(change_url_btn, "#C7D0CC", "#828282")  # изменить цвет кнопки при наведении на нее мышкой

root.mainloop()  # Нарисовать интерфейс программы
</code></pre>
</details>
								
								</section>

			
			
							</div>

						</section>

					</article>

				<!-- Footer -->
					<footer id="footer">
						<ul class="icons">
							
							<li><a href="https://www.facebook.com/valya.guitar" class="icon brands fa-facebook-f"><span class="label">Facebook</span></a></li>
							<li><a href="mailto:vel.kiseleva@gmail.com" class="icon solid fa-envelope"><span class="label">Email</span></a></li>
							<li><a href="https://www.linkedin.com/in/valentina-kiseleva-013782bb" class="fab fa-linkedin-in"><span class="label"></span></a></li>
							<li><a href="https://t.me/vDevOps" class="fab fab fa-telegram"><span class="label"></span></a></li>
						</ul>
						<ul class="copyright">
							<li>&copy; My email</li><li>vel.kiseleva@gmail.com</li>
						</ul>
					</footer>

			</div>

		<!-- Scripts -->
			<script src="/assets/js/jquery.min.js"></script>
			<script src="/assets/js/jquery.scrollex.min.js"></script>
			<script src="/assets/js/jquery.scrolly.min.js"></script>
			<script src="/assets/js/browser.min.js"></script>
			<script src="/assets/js/breakpoints.min.js"></script>
			<script src="/assets/js/util.js"></script>
			<script src="/assets/js/main.js"></script>

	</body>
</html>
